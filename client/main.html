<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Main • 대시보드</title>
  <style>
    :root{
      --bg:#0b1224;
      --fg:#e5e7eb;
      --muted:#94a3b8;
      --card:#0f172acc;
      --border:#1f2a44;
      --ring:#7dd3fc;
      --primary:#60a5fa;
      --tile:#111a33cc;
      --tile-hover:#162244cc;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f8fafc;
        --fg:#0f172a;
        --muted:#64748b;
        --card:#ffffffcc;
        --border:#e2e8f0;
        --ring:#2563eb;
        --primary:#3b82f6;
        --tile:#ffffffcc;
        --tile-hover:#f1f5f9cc;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', Helvetica, Arial;
      color:var(--fg);
      background:
        radial-gradient(1100px 600px at 15% 10%, #1e293b50, transparent 60%),
        radial-gradient(900px 500px at 85% 20%, #312e8155, transparent 60%),
        radial-gradient(900px 500px at 50% 100%, #0ea5e955, transparent 60%),
        var(--bg);
      display:flex; flex-direction:column;
    }

    /* 헤더 */
    header{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 18px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; user-select:none;
    }
    .logo{
      width:34px; height:34px; border-radius:9px;
      background: linear-gradient(135deg,#60a5fa,#8b5cf6);
      display:grid; place-items:center; color:white; font-weight:800; letter-spacing:.2px;
      box-shadow:0 6px 18px rgba(99,102,241,.35);
    }
    .brand span{ font-weight:700 }

    .actions{
      display:flex; align-items:center; gap:10px;
    }
    .avatar{
      width:36px; height:36px; border-radius:50%; background:#1f2a44; color:#cbd5e1;
      display:grid; place-items:center; font-weight:800; cursor:pointer; border:1px solid var(--border);
      transition:box-shadow .2s;
    }
    .avatar:focus-visible{ outline:2px solid var(--ring); outline-offset:2px }
    .menu{
      position:absolute; right:18px; top:60px; width:220px; background:var(--card);
      border:1px solid var(--border); border-radius:12px; padding:8px; display:none; backdrop-filter: blur(10px);
      box-shadow:0 20px 50px rgba(0,0,0,.35);
    }
    .menu.show{ display:block }
    .menu .email{ padding:10px; color:var(--muted); font-size:.9rem; border-bottom:1px solid var(--border) }
    .menu a{
      display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; text-decoration:none; color:var(--fg);
    }
    .menu a:hover{ background:var(--tile-hover) }

    /* 메인 영역 */
    main{
      flex:1;
      display:flex; flex-direction:column;
      align-items:center; justify-content:flex-start;
      padding:28px 16px 40px;
      gap:22px;
    }

    /* 검색/챗봇 바 (크롬 검색창 느낌) */
    .search-wrap{
      width:100%; max-width:750px;
      display:flex; flex-direction:column; align-items:center; gap:12px;
      margin-top:30px;
    }
    .search{
      width:100%; display:flex; align-items:center; gap:10px;
      background:var(--card); border:1px solid var(--border); border-radius:24px; padding:10px 14px;
      box-shadow:0 14px 40px rgba(0,0,0,.25); backdrop-filter: blur(10px);
    }
    .search input{
      flex:1; border:none; background:transparent; color:var(--fg); outline:none; font-size:1.05rem;
    }
    .search button{
      border:none; border-radius:18px; padding:10px 14px; cursor:pointer; color:white; background:var(--primary);
      font-weight:700;
    }
    .greeting{ color:var(--muted); font-size:.95rem }

    /* 타일 그리드 (크롬 바로가기 타일 느낌) */
    .tiles{
      display:grid; grid-template-columns: repeat(4, minmax(140px, 1fr));
      gap:18px; width:100%; max-width:940px; margin-top:6px;
    }
    @media (max-width:900px){
      .tiles{ grid-template-columns: repeat(2,minmax(140px,1fr)); }
    }
    @media (max-width:520px){
      .tiles{ grid-template-columns: 1fr; }
    }

    .tile{
      position:relative;
      background:var(--tile); border:1px solid var(--border); border-radius:18px; padding:16px;
      text-decoration:none; color:var(--fg); display:flex; align-items:center; gap:14px;
      transition: transform .06s ease, background .2s, box-shadow .2s;
      backdrop-filter: blur(10px);
    }
    .tile:hover{ transform: translateY(-2px); background:var(--tile-hover); box-shadow:0 16px 36px rgba(0,0,0,.28) }
    .tile .icon{
      width:42px; height:42px; border-radius:12px; display:grid; place-items:center;
      background:linear-gradient(135deg,#38bdf8,#818cf8);
      box-shadow:0 10px 22px rgba(56,189,248,.35);
    }
    .tile h3{ margin:0; font-size:1.05rem }
    .tile p{ margin:2px 0 0 0; color:var(--muted); font-size:.9rem }

    footer{
      text-align:center; color:var(--muted); font-size:.85rem; padding:18px;
    }

    /* 숨김 텍스트 접근성 */
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0 }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true">GN</div>
      <span>귀농 청년</span>
    </div>

    <div class="actions">
      <div id="avatar" class="avatar" tabindex="0" aria-haspopup="true" aria-expanded="false" title="프로필 및 설정">U</div>
      <nav id="menu" class="menu" aria-label="사용자 메뉴">
        <div class="email" id="userEmailLabel">로그인 정보 없음</div>
        <a href="profile.html" id="profileLink">🧑‍🔧 프로필 업데이트</a>
        <a href="settings.html">⚙️ 설정</a>
        <a href="/logout" id="logoutLink">🚪 로그아웃</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- 검색/챗봇 바 -->
    <section class="search-wrap" aria-labelledby="searchTitle">
      <h1 id="searchTitle" class="sr-only">챗봇 검색</h1>
      <form class="search" id="chatSearch" role="search" action="/chat" method="GET">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M21 21l-4.2-4.2M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z"
                stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input type="search" name="q" id="q" placeholder="무엇이든 물어보세요… (예: 일정 추가, 추천 작물, 정책 지원금)" autocomplete="off" />
        <button type="submit">질문하기</button>
      </form>
      <div class="greeting" id="greeting">환영합니다!</div>
    </section>

    <!-- 타일 버튼 영역 -->
    <section class="tiles" aria-label="빠른 실행">
      <!-- 추천시스템 -->
      <a class="tile" href="recommend.html" aria-label="추천시스템 열기">
        <div class="icon" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M4 4h16v6H4V4Zm0 10h10v6H4v-6Zm12 0h4v6h-4v-6Z" stroke="currentColor" stroke-width="2" />
          </svg>
        </div>
        <div>
          <h3>추천시스템</h3>
          <p>작물/장비/교육 코스 개인화 추천</p>
        </div>
      </a>

      <!-- 일정관리 -->
      <a class="tile" href="calendar.html" aria-label="일정관리 열기">
        <div class="icon" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M7 2v4M17 2v4M3 9h18M5 6h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h3>일정관리</h3>
          <p>파종·수확·교육 일정 한눈에</p>
        </div>
      </a>

      <!-- 정책 정보 -->
      <a class="tile" href="policy.html" aria-label="정책 정보 열기">
        <div class="icon" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M4 6h16M6 10h12M8 14h8M10 18h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h3>정책 정보</h3>
          <p>지원금·교육·임대 정보 모아보기</p>
        </div>
      </a>

      <!-- (선택) 데이터 업로드 / 그 외 기능 -->
      <a class="tile" href="/more" aria-label="추가기능 열기">
        <div class="icon" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h3>더 보기</h3>
          <p>파일 업로드, 리포트, 설정 등</p>
        </div>
      </a>
    </section>
  </main>

  <footer>© <span id="year"></span> 귀농 청년 에이전트</footer>

  <script>
    // ⬇️ 로그인 페이지에서 저장한 사용자 정보 읽기
    const email = sessionStorage.getItem('userEmail') || '';
    const nameFromEmail = email ? email.split('@')[0] : '';
    const avatar = document.getElementById('avatar');
    const menu = document.getElementById('menu');
    const userEmailLabel = document.getElementById('userEmailLabel');
    const greeting = document.getElementById('greeting');

    // 연도
    document.getElementById('year').textContent = new Date().getFullYear();

    // 아바타 이니셜 & 툴팁, 이메일 라벨
    if(email){
      userEmailLabel.textContent = email;
      avatar.title = email + ' • 프로필 및 설정';
      const initial = (nameFromEmail[0] || 'U').toUpperCase();
      avatar.textContent = initial;
      greeting.textContent = `안녕하세요, ${nameFromEmail}님! 무엇을 도와드릴까요?`;
    } else {
      avatar.textContent = 'U';
      greeting.textContent = '환영합니다! 로그인 정보를 불러오지 못했어요.';
    }

    // 아바타 클릭/키보드로 메뉴 토글
    function toggleMenu(show) {
      const isShow = show ?? !menu.classList.contains('show');
      menu.classList.toggle('show', isShow);
      avatar.setAttribute('aria-expanded', String(isShow));
    }
    avatar.addEventListener('click', () => toggleMenu());
    avatar.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleMenu(); }
      if(e.key === 'Escape'){ toggleMenu(false); }
    });
    document.addEventListener('click', (e) => {
      if(!menu.contains(e.target) && e.target !== avatar){ toggleMenu(false); }
    });

    // 챗봇 검색 제출 시 /chat?q=... 로 이동 (기본 action도 /chat)
    document.getElementById('chatSearch').addEventListener('submit', (e) => {
      const q = document.getElementById('q').value.trim();
      if(!q){ e.preventDefault(); document.getElementById('q').focus(); }
    });

    // 로그아웃 클릭 시 세션 정리 (라우팅은 서버에 맞게)
    document.getElementById('logoutLink').addEventListener('click', (e) => {
      sessionStorage.clear();
    });

    // 프로필 업데이트 라우트 예시 (원하면 쿼리로 이메일 전달)
    document.getElementById('profileLink').addEventListener('click', (e) => {
      if(email){ e.currentTarget.href = `/profile?email=${encodeURIComponent(email)}`; }
    });
  </script>
</body>
</html>
